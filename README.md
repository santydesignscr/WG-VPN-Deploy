# WG-VPN-Deploy
A simple bash script that deploy a WireGuard VPN server (with web UI) on Debian 11 with WARP IPV4 included and IPV6 internet access ready and Client-Client, Client-Host or Host-Client reachability.

# How to use:
It's very easy only run the following command and follow the instructions<br>
`wget https://raw.githubusercontent.com/santydesignscr/WG-VPN-Deploy/main/VPN-Deploy.sh && bash VPN-Deploy.sh`

# Manual Installation:
<p>Used OS: Debian 11</p>
<ol>
<li>First you need to setup WARP to get IPV4 internet from the server:<br />wget -N https://raw.githubusercontent.com/fscarmen/warp/main/menu.sh &amp;&amp; bash menu.sh 4<br />Options:<br />WARP Type: Select option 1 (Use free account)<br />Priority: Option 3 (Use initial settings)<br /><br /></li>
<li>You need a port from HAX IPv4 Gateway to access IPv6:<br />IP Address: Select any that you want from the list<br />Port: Use any available from 1000 to 10000<br />Protocol: UDP<br />Your IPv6 Address: &nbsp;VPS IPV6 address<br />Port: Same selected before<br /><br /></li>
<li>Now you need to get a domain and add the DNS records:<br />First you need to create a A record with the IP Address from HAX IPv4 Gateway to access IPv6 Proxy disabled<br />1. And a AAA record with the VPS IPV6 Proxy disabled<br />2. And a AAA record with the VPS IPV6 Proxy enabled<br />3. The A record and the AAA record with proxy disabled need to have the same record name and use diferent for the another AAA record (The record with proxy enabled will be your URL for the WireGuard UI)<br /><br /></li>
<li>Now you need to setup a WireGuard VPN server (normal):<br />wget https://git.io/wireguard -O wireguard-install.sh &amp;&amp; bash wireguard-install.sh<br />Options:<br />Public IPv4 address / hostname: Your domain where you added IPV6 and IPV4<br />IPV6 used: Most times option 1 but check what is the correct VPS IP (See it in VPS Info page)<br />WireGuard Port: The one that you get from HAX IPv4 Gateway to access IPv6<br />Name for first client: Any that you want without spaces.<br />DNS server for client: Option 1<br />WireGuard Auto-Updates: Select y (yes)<br />Press any key to continue<br /><br /></li>
<li>Now you need to install WireGuard UI for easily management of server:<br />echo "net.ipv4.ip_forward=1" &gt;&gt; /etc/sysctl.conf<br />echo "net.ipv6.conf.all.forwarding=1" &gt;&gt; /etc/sysctl.conf<br />sysctl -p<br />cd /etc/wireguard<br /><br />cat &lt;&lt;EOF &gt; /etc/wireguard/start-wgui.sh<br />#!/bin/bash<br />cd /etc/wireguard<br />./wireguard-ui -bind-address 0.0.0.0:80<br />EOF<br /><br />chmod +x start-wgui.sh<br /><br />cat &lt;&lt;EOF &gt; /etc/systemd/system/wgui-web.service<br />[Unit]<br />Description=WireGuard UI<br />[Service]<br />Type=simple<br />ExecStart=/etc/wireguard/start-wgui.sh<br />[Install]<br />WantedBy=multi-user.target<br />EOF<br /><br />cat &lt;&lt;EOF &gt; /etc/wireguard/update.sh<br />#!/bin/bash<br />VER=\$(curl -sI https://github.com/ngoduykhanh/wireguard-ui/releases/latest | grep "location:" | cut -d "/" -f8 | tr -d '\r')<br />echo "downloading wireguard-ui \$VER"<br />curl -sL "https://github.com/ngoduykhanh/wireguard-ui/releases/download/\$VER/wireguard-ui-\$VER-linux-amd64.tar.gz" -o wireguard-ui-\$VER-linux-amd64.tar.gz<br />echo -n "extracting "<br />tar xvf wireguard-ui-\$VER-linux-amd64.tar.gz<br />echo "restarting wgui-web.service"<br />systemctl restart wgui-web.service<br />EOF<br /><br />chmod +x /etc/wireguard/update.sh<br />./update.sh<br /><br />cat &lt;&lt;EOF &gt; /etc/systemd/system/wgui.service<br />[Unit]<br />Description=Restart WireGuard<br />After=network.target<br />[Service]<br />Type=oneshot<br />ExecStart=/bin/systemctl restart <a href="mailto:wg-quick@wg0.service">wg-quick@wg0.service</a><br />[Install]<br />RequiredBy=wgui.path<br />EOF<br /><br />cat &lt;&lt;EOF &gt; /etc/systemd/system/wgui.path<br />[Unit]<br />Description=Watch /etc/wireguard/wg0.conf for changes<br />[Path]<br />PathModified=/etc/wireguard/wg0.conf<br />[Install]<br />WantedBy=multi-user.target<br />EOF<br /><br />touch /etc/wireguard/wg0.conf<br />systemctl enable wgui.{path,service} wg-quick@wg0.service wgui-web.service<br />systemctl start wgui.{path,service}<br /><br />nano db/users/admin.json (Replace "password": "" with "password": "admin",)<br /><br />nano db/server/global_settings.json<br />&nbsp; &nbsp; &nbsp;Change endpoint_address value to your domain where ypu added the DNS records<br />&nbsp; &nbsp; &nbsp;Change dns-servers value to "1.1.1.1", "2606:4700::1111"<br /><br />nano db/server/interfaces.json<br />&nbsp; &nbsp; &nbsp;Change addresses value to "10.7.0.1/24", "fddd:2c4:2c4:2c4::1/64"<br />&nbsp; &nbsp; &nbsp;Change listen_port value to the port you used in HAX IPv4 Gateway to access IPv6<br />&nbsp; &nbsp; &nbsp;Change post_up value to "iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE"<br />&nbsp; &nbsp; &nbsp;Change post_down value to "iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE"<br /><br /></li>
<li>Now you can access to the WireGuard UI from the domain that you added the AAA record with proxy enabled:<br />First create the clients that you need from the UI (Add ::/0 on Allowed IPs to enabled IPV6 internet access for the client)<br />Click on Apply Config to refresh the WireGuard server configuration</li>
</ol>
<p></p>
<p><strong>Notes:</strong></p>
<ul>
<li>Each time that you change something on the server configuration or add/edit a client on the WireGuard UI click on Apply Config</li>
<li>Default username and password for the WireGuard UI is admin, for security reasons change the password for the admin user from the WireGuard UI</li>
</ul>
<p>And Ready, enjoy your VPN!</p>
